<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>STOMP 텍스트 테스트</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>더미 텍스트 발언 테스트</h2>

<label>Room UUID:
  <input type="text" id="roomUUID" value="1"/>
</label>
<br/>
<label>User ID (숫자):
  <input type="number" id="userId" value="1"/>
</label>
<br/>
<input type="text" id="message" placeholder="텍스트 입력" value="이것은 더미 테스트 메시지입니다."/>
<button onclick="sendMessage()">전송</button>

<h3>수신된 메시지</h3>
<pre id="received"></pre>

<script>
  let stompClient = null;

  function connect() {
    const socket = new SockJS('/ws-speech');
    stompClient = Stomp.over(socket);

    stompClient.connect({}, function () {
      const roomUUID = document.getElementById('roomUUID').value;
      stompClient.subscribe(`/topic/speaker/${roomUUID}`, function (msg) {
        const body = JSON.parse(msg.body);
        document.getElementById('received').textContent += `[${body.username ?? "?"}] ${body.message}\n`;
      });
    });
  }

  function sendMessage() {
    const payload = {
      roomUUID: document.getElementById('roomUUID').value,
      userId: Number(document.getElementById('userId').value),
      message: document.getElementById('message').value
    };

    stompClient.send("/pub/speaker/text", {}, JSON.stringify(payload));
  }

  window.onload = connect;
</script>
</body>
</html>
